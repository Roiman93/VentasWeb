window.addEventListener("load",(function(){$("#c_cliente").focus(),invoiceDetails()}));var txt_cod,elem=document.getElementById("c_cliente");function validateStock(t){let e=parseInt($("#txt_existencia").html()),a=parseInt(t);if(isNaN(a)||a<=0||a>e)return clearProductInfo([{id:"add_producto",visibility:"hidden",tipo:"val"}]),$("#txt_cant_producto").addClass("is-invalid"),$("#txt_cant_producto").removeClass("is-valid"),$("#txt_cant_producto").parent().addClass("error"),$("#txt_cant_producto").parent().removeClass("success"),swal({title:"Error",text:"La cantidad ingresada supera el stock disponible",icon:"warning"}),!1;return clearProductInfo([{id:"add_producto",value:"",visibility:"visible",tipo:"val"}],"val"),$("#add_producto").show(),$("#txt_cant_producto").removeClass("is-invalid"),$("#txt_cant_producto").addClass("is-valid"),$("#txt_cant_producto").parent().removeClass("error"),$("#txt_cant_producto").parent().addClass("success"),!0}function validarCant(){var t=$("#txt_cant_producto").val(),e=$("#txt_precio").html(),a="";validateStock(t)&&(a=t*e,$("#txt_precio_total").html(a),$("#add_producto").focus())}async function consultApiClients(){var t=$("#c_cliente").val();const e=new FormData;e.append("date",t);try{const t="http://ventasweb.local/api/cliente",a=await fetch(t,{method:"POST",body:e});data=await a.json(),displayClientResult(data)}catch(t){}}function displayClientResult(t){void 0===t?swal({title:"Error",text:"No se recibió respuesta del servidor",icon:"warning",buttons:!0,dangerMode:!0}).then(t=>{t&&$("#c_cliente").focus()}):t.error?swal({title:"Error",text:t.error,icon:"warning",buttons:!0,dangerMode:!0}).then(t=>{t&&$("#c_cliente").focus()}):null===t.resultado?swal({title:"Cedula No Registrada",text:"Desea Registrar el Nuevo Cliente",icon:"warning",buttons:!0,dangerMode:!0}).then(t=>{t?($("#nom_cliente, #nom2_cliente, #ap_cliente, #ap2_cliente").prop("disabled",!1),$("#txt_cod_producto").prop("disabled",!0),$("#id_cliente, #nom_cliente, #nom2_cliente, #ap_cliente, #ap2_cliente").val(""),$("#nom_cliente").focus(),$("#btn_new_cliente, #btn_cancel_cliente").slideDown()):$("#c_cliente").focus()}):($("#id_cliente").val(t.resultado.id),$("#nom_cliente").val(t.resultado.nombre),$("#nom2_cliente").val(t.resultado.s_nombre),$("#ap_cliente").val(t.resultado.apellido),$("#ap2_cliente").val(t.resultado.s_apellido),$("#btn_new_cliente, #btn_cancel_cliente").slideUp(),$("#txt_cod_producto").prop("disabled",!1),$("#c_cliente, #idcliente, #nom_cliente, #nom2_cliente, #ap_cliente, #ap2_cliente").prop("disabled",!0),$("#txt_cod_producto").focus())}async function consultApiProducts(){var t=$("#txt_cod_producto").val();const e=new FormData;e.append("data",t);try{const t="http://ventasweb.local/api/get_stock_producto",a=await fetch(t,{method:"POST",body:e});data=await a.json(),displayProductResult(data)}catch(t){}}function displayProductResult(t){t.error?swal({title:"Error",text:t.error,icon:"warning"}).then((function(){$("#txt_cant_producto").prop("disabled",!0),$("#add_producto").slideUp(),$("#txt_cod_producto").focus()})):t.resultado?($("#id").html(t.resultado.id_producto),$("#txt_descripcion").html(t.resultado.nombre),$("#txt_existencia").html(t.resultado.stock),$("#txt_cant_producto").val("1"),$("#txt_precio").html(t.resultado.precio_venta),$("#txt_precio_total").html(t.resultado.precio_venta),$("#txt_cant_producto").prop("disabled",!1),$("#txt_cant_producto").focus()):(console.log("mostrando resultados de los productos"),$("#id_producto").html(""),$("#txt_descripcion").html("-"),$("#txt_existencia").html("-"),$("#txt_cant_producto").html("0"),$("#txt_precio").html("0.00"),$("#txt_precio_total").html("0.00"),$("#txt_cant_producto").prop("disabled",!0),$("#add_producto").slideUp(),$("#txt_cod_producto").focus())}async function addProductToListDetails(){var t=$("#id").html(),e=$("#txt_cant_producto").val(),a=$("#txt_precio").html(),o=$("#txt_token").val();if(e.match(/^[0-9]+$/)&&""!==e){const l=new FormData;l.append("id_producto",t),l.append("cantidad",e),l.append("precio_venta",a),l.append("mesa",null),l.append("token_user",o);try{const t="http://ventasweb.local/api/get_add_detalle_producto",e=await fetch(t,{method:"POST",body:l});displayProductDetails(await e.json())}catch(t){}}else alert("No es numérico")}async function deleteProductAPI(t){var e=$("#txt_token").val();const a=new FormData;a.append("id",t),a.append("token_user",e);try{const t="http://ventasweb.local/api/delete_detalle_producto",e=await fetch(t,{method:"POST",body:a});data=await e.json(),displayProductDetails(data)}catch(t){}}async function invoiceDetails(){var t=$("#txt_token").val();const e=new FormData;e.append("token_user",t);try{const t="http://ventasweb.local/api/detalle",a=await fetch(t,{method:"POST",body:e});data=await a.json(),displayProductDetails(data)}catch(t){}}function displayProductDetails(t){if(t.error)swal({title:"Error",text:t.error,icon:"warning"}).then((function(){}));else if(t.resultado){$("#detalle_venta").html(t.resultado),$("#txt_iva").html(t.resumen.iva),$("#txt_subtotal").html(t.resumen.sub_total),$("#txt_total").html(t.resumen.total),clearProductInfo([{id:"add_producto",visibility:"hidden",tipo:"val"},{id:"txt_cod_producto",value:"",focus:!0,tipo:"val"},{id:"txt_descripcion",value:"-",tipo:"html"},{id:"txt_existencia",value:"-",tipo:"html"},{id:"txt_cant_producto",value:"0",disabled:!0,tipo:"html"},{id:"txt_precio",value:"0.00",tipo:"html"},{id:"txt_precio_total",value:"0.00",tipo:"html"}])}else{let t=[{id:"detalle_venta",value:"",tipo:"html"},{id:"txt_iva",value:"",tipo:"html"},{id:"txt_subtotal",value:"-",tipo:"html"},{id:"txt_total",value:"-",tipo:"html"}];clearProductInfo([{id:"add_producto",visibility:"hidden",tipo:"val"},{id:"txt_cod_producto",value:"",focus:!0,tipo:"val"},{id:"txt_descripcion",value:"-",tipo:"html"},{id:"txt_existencia",value:"-",tipo:"html"},{id:"txt_cant_producto",value:"0",disabled:!0,tipo:"html"},{id:"txt_precio",value:"0.00",tipo:"html"},{id:"txt_precio_total",value:"0.00",tipo:"html"}]),clearProductInfo(t)}}async function saveInvoice(){if(validateForm("cliente_frm")&&validateTable("stdclass-table")){var t=$("#txt_token").val(),e=$("#txt_prej").val(),a=$("#txt_prej_num").val(),o=$("#id_cliente").val(),l=$("#txt_id").val(),i=$("#txt_total").html();const n=new FormData;n.append("token_user",t),n.append("prefijo",e),n.append("numero",a),n.append("id_cliente",o),n.append("usuario",l),n.append("total",i);try{const t="http://ventasweb.local/api/process",e=await fetch(t,{method:"POST",body:n});data=await e.json(),console.log(data),data.error?swal({title:"Error al crear factur",text:data.error,icon:"warning"}).then((function(){})):data.resultado&&swal({title:"Factura generada",text:data.resultado,icon:"success",type:"success",confirmButtonText:"Aceptar",allowOutsideClick:!0}).then((function(){location.reload()}))}catch(t){}}else swal({title:"Error al crear factura",text:"Por favor, revise que los campos de la factura estén diligenciados correctamente. Asegúrese de completar todos los campos obligatorios y verificar que los datos ingresados sean correctos. Si necesita ayuda, consulte nuestra documentación en línea.",icon:"warning",buttons:{cancel:"Cerrar",help:{text:"Ayuda",value:"help"}}}).then((function(t){"help"===t&&window.open("https://ejemplo.com/ayuda","_blank")}))}async function cancelInvoice(){if(validateTable("stdclass-table")){var t=$("#txt_token").val();const e=new FormData;e.append("token_user",t);try{const t="http://ventasweb.local/api/cancel_process",a=await fetch(t,{method:"POST",body:e});data=await a.json(),console.log(data),data.error?swal({title:"Error al cancelar la factura",text:data.error,icon:"warning"}).then((function(){})):data.resultado&&swal({title:"Factura cancelada",text:data.resultado,icon:"success",type:"success",confirmButtonText:"Aceptar",allowOutsideClick:!0}).then((function(){clearProductInfo([{id:"id_cliente",value:"",disabled:!1,tipo:"val"},{id:"c_cliente",value:"",disabled:!1,focus:!1,tipo:"val"},{id:"nom_cliente",value:"",disabled:!1,tipo:"val"},{id:"nom2_cliente",value:"",disabled:!1,tipo:"val"},{id:"ap_cliente",value:"",disabled:!1,tipo:"val"},{id:"ap2_cliente",value:"",disabled:!1,tipo:"val"}]),clearProductInfo([{id:"add_producto",visibility:"hidden",tipo:"val"},{id:"txt_cod_producto",value:"",disabled:!0,tipo:"val"},{id:"txt_descripcion",value:"-",tipo:"html"},{id:"txt_existencia",value:"-",tipo:"html"},{id:"txt_cant_producto",value:"",disabled:!0,tipo:"html"},{id:"txt_precio",value:"0.00",tipo:"html"},{id:"txt_precio_total",value:"0.00",tipo:"html"}]),clearProductInfo([{id:"detalle_venta",value:"",tipo:"html"},{id:"txt_iva",value:"",tipo:"html"},{id:"txt_subtotal",value:"",tipo:"html"},{id:"txt_total",value:"",tipo:"html"}])}))}catch(t){}}else{let t=[{id:"detalle_venta",value:"",tipo:"html"},{id:"txt_iva",value:"",tipo:"html"},{id:"txt_subtotal",value:"",tipo:"html"},{id:"txt_total",value:"",tipo:"html"}],e=[{id:"add_producto",visibility:"hidden",tipo:"val"},{id:"txt_cod_producto",value:"",disabled:!0,tipo:"val"},{id:"txt_descripcion",value:"-",tipo:"html"},{id:"txt_existencia",value:"-",tipo:"html"},{id:"txt_cant_producto",value:"",disabled:!0,tipo:"html"},{id:"txt_precio",value:"0.00",tipo:"html"},{id:"txt_precio_total",value:"0.00",tipo:"html"}];clearProductInfo([{id:"id_cliente",value:"",disabled:!1,tipo:"val"},{id:"c_cliente",value:"",disabled:!1,focus:!1,tipo:"val"},{id:"nom_cliente",value:"",disabled:!1,tipo:"val"},{id:"nom2_cliente",value:"",disabled:!1,tipo:"val"},{id:"ap_cliente",value:"",disabled:!1,tipo:"val"},{id:"ap2_cliente",value:"",disabled:!1,tipo:"val"}]),clearProductInfo(e),clearProductInfo(t)}}function deleteRecord(t){swal({title:"¿Seguro que deseas eliminar el Registro?",text:"No podrás deshacer este paso...",icon:"warning",buttons:!0,dangerMode:!0}).then(e=>{e?deleteProductAPI(t)&&swal("!Registro Eliminado!",{icon:"success"}):swal("!No se Realizo Ningun Cambio!")})}elem.onkeyup=function(t){13==t.keyCode&&consultApiClients()},(txt_cod=document.getElementById("txt_cod_producto")).onkeyup=function(t){13==t.keyCode&&consultApiProducts()},(txt_cod=document.getElementById("txt_cant_producto")).onkeyup=function(t){13==t.keyCode&&validarCant()},$("#btn_new_cliente").click((function(t){t.preventDefault();var e=$("#c_cliente").val(),a=$("#nom_cliente").val(),o=$("#nom2_cliente").val(),l=$("#ap_cliente").val(),i=$("#ap2_cliente").val();""==$("#c_cliente").val()||""==$("#nom_cliente").val()||""==$("#ap_cliente")||""==$("#ap2_cliente").val()?swal({title:"Oops!",text:"Llene todos los Campos Requeridos",icon:"warning",button:"ok"}).then(t=>{}):$.ajax({url:"modelo/ajax.php",type:"POST",async:!0,data:{action:"addCliente",cedula:e,nombre1:a,nombre2:o,apellido1:l,apellido2:i},success:function(t){""==t?swal({title:"Guardado",text:"Registro Almacenado Exitosamente!",icon:"success",button:"ok"}).then(t=>{t&&($("#btn_new_cliente").slideUp(),$("#idcliente").prop("disabled",!0),$("#nom_cliente").prop("disabled",!0),$("#nom2_cliente").prop("disabled",!0),$("#ap_cliente").prop("disabled",!0),$("#ap2_cliente").prop("disabled",!0),$("#txt_cod_producto").focus())}):swal({title:"Oops!",text:"Ha ocurrido un  "+t,icon:"warning",button:"ok"}).then(t=>{})},error:function(t){}})})),$("#add_product").click((function(t){validateStock($("#txt_cant_producto").val())&&addProductToListDetails()})),$("#btn_cancel").click((function(t){swal({title:"¿Realmente deseas cancelar la Factura?",text:"Se Borrara toda la informacion...",icon:"warning",buttons:!0,dangerMode:!0}).then(t=>{t?cancelInvoice():swal("!No se realizo ninguna Acción!")})})),$("#btn_save").click((function(t){saveInvoice()}));